<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>AI Tarot ‚Ä¢ Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg:#060612; --fg:#f6f3ff; --muted:#bdb6df; --glass:rgba(255,255,255,.06);
      --border:rgba(255,255,255,.14); --accent:#8c6bff; --accent2:#2ad2ff; --accent3:#ff6ad5;
      --glow:0 0 14px rgba(140,107,255,.65), 0 0 28px rgba(57,189,255,.35); --radius:16px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;color:var(--fg);
      background:
        radial-gradient(1000px 600px at 10% -10%, rgba(140,107,255,.25), transparent 60%),
        radial-gradient(900px 700px at 100% 0%, rgba(57,189,255,.20), transparent 60%),
        radial-gradient(800px 700px at 100% 100%, rgba(255,106,213,.16), transparent 60%),
        #060612;
      font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }
    .wrap{max-width:980px;margin:0 auto;padding:16px 14px 28px;position:relative}
    .muted{color:var(--muted)} .tiny{font-size:12px}
    .header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px;
      position:sticky;top:0;z-index:9;background:linear-gradient(180deg, rgba(6,6,18,.9), rgba(6,6,18,.6));
      backdrop-filter:blur(6px);padding:10px;border-bottom:1px solid var(--border);
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:34px;height:34px;border-radius:12px;background:conic-gradient(from 0deg, var(--accent), var(--accent2), var(--accent3), var(--accent));box-shadow:var(--glow);position:relative;overflow:hidden}
    .logo::after{content:"";position:absolute;inset:2px;border-radius:10px;background:#09091a}
    .title{font-weight:900;font-size:17px;letter-spacing:.3px}
    .pill{border:1px solid rgba(255,255,255,.2);border-radius:999px;padding:6px 10px;font-weight:900;background:rgba(255,255,255,.06)}
    .btn{
      appearance:none;border:1px solid var(--border);background:linear-gradient(90deg, rgba(140,107,255,.25), rgba(57,189,255,.2));
      color:#fff;border-radius:12px;padding:10px 14px;font-weight:900;cursor:pointer;
      box-shadow:0 12px 40px rgba(140,107,255,.18);transition:transform .12s, box-shadow .2s, filter .2s;
    }
    .btn:hover{transform:translateY(-1px);filter:brightness(1.08)}
    .btn.primary{background:linear-gradient(90deg, var(--accent), var(--accent2)); box-shadow:var(--glow); border-color:transparent}
    .btn.ghost{background:transparent}
    .grid{display:grid;gap:12px}
    @media (min-width:860px){ .grid.cols-2{grid-template-columns:repeat(2,1fr)} .grid.cols-3{grid-template-columns:repeat(3,1fr)} }
    .card{border:1px solid var(--border);border-radius:var(--radius);background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03))}
    .card.pad{padding:14px}
    .glass{border:1px solid var(--border);border-radius:var(--radius);background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));padding:14px}
    h2{margin:0 0 10px 0;font-size:18px} h3{margin:0 0 8px 0;font-size:16px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap} .spacer{height:6px}
    .divider{height:1px;background:linear-gradient(90deg, transparent, rgba(255,255,255,.18), transparent);margin:12px 0}
    .actions{display:grid;gap:10px;grid-template-columns:repeat(2,1fr)} @media (min-width:700px){ .actions{grid-template-columns:repeat(5,1fr)} }
    .action{padding:12px;border-radius:14px;border:1px solid var(--border);background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));text-align:center;cursor:pointer;user-select:none;transition:transform .12s, box-shadow .2s}
    .action:hover{transform:translateY(-2px);box-shadow:var(--glow)}
    .ico{font-size:22px;margin-bottom:6px;display:inline-block;filter:drop-shadow(0 0 12px rgba(140,107,255,.65))}
    input[type="text"],input[type="time"],input[type="number"],select{
      appearance:none;border:1px solid var(--border);border-radius:10px;padding:10px 12px;background:rgba(255,255,255,.03);color:var(--fg);outline:none;min-width:140px
    }
    input[type="range"]{width:220px}
    /* Slider */
    .slider{position:relative;height:140px;overflow:hidden;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02))}
    .slide{position:absolute;inset:0;padding:14px 14px 22px 14px;opacity:0;transform:scale(.98);transition:opacity .6s, transform .6s;display:flex;align-items:center;gap:12px}
    .slide.active{opacity:1;transform:scale(1)}
    .ava{width:48px;height:48px;border-radius:999px;background:radial-gradient(circle at 30% 30%, #fff, #bbb);border:2px solid rgba(255,255,255,.25);box-shadow:0 0 20px rgba(140,107,255,.35)}
    .starline{color:#ffd147;text-shadow:0 0 12px rgba(255,209,71,.6)}
    .dots{position:absolute;left:0;right:0;bottom:6px;display:flex;justify-content:center;gap:6px}
    .dot{width:7px;height:7px;border-radius:8px;background:rgba(255,255,255,.25);transition:width .3s}
    .dot.active{background:linear-gradient(90deg, var(--accent), var(--accent2));box-shadow:var(--glow);width:22px}
    /* Bottom sheet shop */
    .sheet{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(8px);display:none;align-items:flex-end;z-index:50}
    .sheet.open{display:flex}
    .box{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));border-top:1px solid var(--border);width:100%;max-width:980px;margin:0 auto;border-radius:16px 16px 0 0;padding:14px}
    .packs{display:grid;gap:10px}
    .pack{display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:center;border:1px solid var(--border);border-radius:12px;padding:10px}
    @media (max-width:520px){ .pack{grid-template-columns:1fr} }
    /* Tabs & pages */
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:linear-gradient(90deg, rgba(140,107,255,.15), rgba(57,189,255,.12));cursor:pointer;font-weight:900}
    .tab.active{background:linear-gradient(90deg, var(--accent), var(--accent2));box-shadow:var(--glow)}
    .page{display:none;animation:fadeIn .35s ease both}
    .page.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none}}
    /* Horoscope */
    .zodiac-grid{display:grid;gap:10px;grid-template-columns:repeat(2,1fr)}
    @media (min-width:680px){ .zodiac-grid{grid-template-columns:repeat(6,1fr)} }
    .z-card{border:1px solid var(--border);border-radius:14px;padding:12px;text-align:center;cursor:pointer;background:radial-gradient(200px 120px at 50% 0%, rgba(140,107,255,.22), rgba(255,255,255,.02));transition:transform .12s, box-shadow .2s, border-color .2s}
    .z-card:hover{transform:translateY(-2px);box-shadow:var(--glow);border-color:rgba(140,107,255,.5)}
    .z-ico{font-size:26px;display:block;margin-bottom:6px;filter:drop-shadow(0 0 10px rgba(140,107,255,.6))}
    .footnote{font-size:12px;color:var(--muted);text-align:center;margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Header -->
    <div class="header">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div class="title">AI Tarot ‚Ä¢ Mini App</div>
          <div class="muted tiny" id="hello">@user</div>
        </div>
      </div>
      <div class="row">
        <button class="btn" id="btnTopup">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
        <div class="pill" id="clock">--:--</div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="row tabs" style="margin:8px 2px 12px 2px">
      <div class="tab active" data-page="home">–ì–ª–∞–≤–Ω–∞—è</div>
      <div class="tab" data-page="horoscope">–ì–æ—Ä–æ—Å–∫–æ–ø</div>
      <div class="tab" data-page="more">–ï—â—ë</div>
    </div>

    <!-- Page: Home -->
    <section class="page active" id="page-home">
      <div class="grid cols-2">
        <div class="card">
          <div class="slider" id="slider">
            <div class="slide active">
              <div class="ava"></div>
              <div><div class="starline">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>¬´–ë–æ—Ç –ø–æ–ø–∞–ª –≤ —Ç–æ—á–∫—É! –≠—Ñ—Ñ–µ–∫—Ç–Ω–æ –∏ –±–µ—Ä–µ–∂–Ω–æ.¬ª ‚Äî –ê–Ω–Ω–∞</div>
            </div>
            <div class="slide">
              <div class="ava"></div>
              <div><div class="starline">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>¬´–ü–∞–∫–µ—Ç –∫—É–ø–∏–ª, —Ä–∞—Å–∫–ª–∞–¥—ã —à–∏–∫–∞—Ä–Ω—ã–µ, –≤–∏–∑—É–∞–ª –æ–≥–æ–Ω—å!¬ª ‚Äî –î–º–∏—Ç—Ä–∏–π</div>
            </div>
            <div class="slide">
              <div class="ava"></div>
              <div><div class="starline">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>¬´–ö–∞—Ä—Ç–∞ –¥–Ω—è ‚Äî –º–æ–π —É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–∏—Ç—É–∞–ª. –°–ø–∞—Å–∏–±–æ!¬ª ‚Äî –ú–∞—Ä–∏–Ω–∞</div>
            </div>
            <div class="dots" id="dots">
              <div class="dot active"></div><div class="dot"></div><div class="dot"></div>
            </div>
          </div>
        </div>
        <div class="glass">
          <h2>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
          <div class="actions" style="margin-top:8px">
            <div class="action" data-act="card_of_day"><div class="ico">üÉè</div>–ö–∞—Ä—Ç–∞ –¥–Ω—è</div>
            <div class="action" data-act="three"><div class="ico">üîÆ</div>3 –∫–∞—Ä—Ç—ã</div>
            <div class="action" data-act="week"><div class="ico">üìÖ</div>–ù–µ–¥–µ–ª—è</div>
            <div class="action" data-act="yes_no"><div class="ico">‚ùì</div>–î–∞ / –ù–µ—Ç</div>
            <div class="action" data-act="ask"><div class="ico">üí¨</div>–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</div>
          </div>
        </div>
      </div>

      <div class="spacer"></div>

      <div class="card pad">
        <h2>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Ä–∞—Å–∫–ª–∞–¥–∞</h2>
        <div class="row">
          <span class="muted">–ö–æ–ª-–≤–æ –∫–∞—Ä—Ç:</span>
          <input id="cardsRange" type="range" min="2" max="10" value="3">
          <span class="pill" id="cardsOut">3</span>
        </div>
        <div class="row" style="margin-top:8px">
          <input id="topicInput" type="text" placeholder="–¢–µ–º–∞/–≤–æ–ø—Ä–æ—Å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="flex:1;min-width:220px">
          <button class="btn primary" id="btnDoCustom">–°–¥–µ–ª–∞—Ç—å —Ä–∞—Å–∫–ª–∞–¥</button>
        </div>
      </div>

      <div class="spacer"></div>

      <div class="grid cols-3">
        <div class="card pad">
          <h3>–ü–æ–¥–ø–∏—Å–∫–∞ ¬´–ö–∞—Ä—Ç–∞ –¥–Ω—è¬ª</h3>
          <div class="row" style="margin-top:6px">
            <span class="muted">–í—Ä–µ–º—è:</span>
            <input id="codTime" type="time" value="09:00">
            <label class="row" style="gap:6px"><input id="codToggle" type="checkbox" checked>–í–∫–ª—é—á–∏—Ç—å</label>
          </div>
          <div class="row" style="margin-top:10px">
            <button class="btn" id="btnCodSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
          <div class="tiny muted" style="margin-top:8px">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ –ø—Ä–∏—à–ª—ë–º –∫–∞—Ä—Ç—É –¥–Ω—è –≤ —á–∞—Ç.</div>
        </div>

        <div class="card pad">
          <h3>–ü—Ä–æ–º–æ–∫–æ–¥</h3>
          <div class="row" style="margin-top:6px">
            <input id="promoInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" style="flex:1;min-width:120px">
            <button class="btn" id="btnPromo">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
          </div>
          <div class="divider"></div>
          <h3>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</h3>
          <div class="row" style="margin-top:6px">
            <button class="btn ghost" id="btnRef">–ü–æ–∫–∞–∑–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            <div class="tiny muted">–ó–∞ –¥—Ä—É–≥–∞ ‚Äî –±–æ–Ω—É—Å</div>
          </div>
        </div>

        <div class="card pad">
          <h3>–ë—ã—Å—Ç—Ä—ã–µ —Ç–µ–º—ã</h3>
          <div class="row" style="margin-top:6px">
            <button class="btn ghost fast" data-act="custom_spread" data-n="5" data-topic="–û—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –ª—é–±–æ–≤—å">üíû –û—Ç–Ω–æ—à–µ–Ω–∏—è</button>
            <button class="btn ghost fast" data-act="custom_spread" data-n="5" data-topic="–ö–∞—Ä—å–µ—Ä–∞ –∏ —Ä–∞–±–æ—Ç–∞">üíº –†–∞–±–æ—Ç–∞</button>
          </div>
          <div class="row" style="margin-top:8px">
            <button class="btn ghost fast" data-act="custom_spread" data-n="5" data-topic="–§–∏–Ω–∞–Ω—Å—ã –∏ –¥–æ—Ö–æ–¥—ã">üí∞ –§–∏–Ω–∞–Ω—Å—ã</button>
            <button class="btn ghost fast-yn" data-topic="–ú–æ–π —à–∞–Ω—Å –Ω–∞ —É—Å–ø–µ—Ö">üéØ –î–∞/–ù–µ—Ç</button>
          </div>
          <div class="divider"></div>
          <div class="row">
            <button class="btn" id="btnHistory">–ò—Å—Ç–æ—Ä–∏—è</button>
            <button class="btn ghost" id="btnSupport">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
          </div>
        </div>
      </div>
      <div class="footnote">1 –æ—Ç–≤–µ—Ç –ò–ò –∏–ª–∏ —Ä–∞—Å–∫–ª–∞–¥ = 1 —Å–æ–æ–±—â–µ–Ω–∏–µ. –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ü–æ–ø–æ–ª–Ω–∏—Ç—å¬ª.</div>
    </section>

    <!-- Page: Horoscope -->
    <section class="page" id="page-horoscope">
      <div class="card pad">
        <h2 style="display:flex;align-items:center;gap:10px"><span style="filter:drop-shadow(0 0 10px rgba(255,106,213,.6))">‚ú®</span>–ú–∞–≥–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ—Å–∫–æ–ø</h2>
        <div class="row" style="margin-top:6px">
          <span class="muted">–ü–µ—Ä–∏–æ–¥:</span>
          <select id="horPeriod"><option value="today">–°–µ–≥–æ–¥–Ω—è</option><option value="week">–ù–µ–¥–µ–ª—è</option></select>
        </div>
        <div class="zodiac-grid" style="margin-top:10px">
          <div class="z-card" data-sign="aries"><span class="z-ico">‚ôà</span>–û–≤–µ–Ω</div>
          <div class="z-card" data-sign="taurus"><span class="z-ico">‚ôâ</span>–¢–µ–ª–µ—Ü</div>
          <div class="z-card" data-sign="gemini"><span class="z-ico">‚ôä</span>–ë–ª–∏–∑–Ω–µ—Ü—ã</div>
          <div class="z-card" data-sign="cancer"><span class="z-ico">‚ôã</span>–†–∞–∫</div>
          <div class="z-card" data-sign="leo"><span class="z-ico">‚ôå</span>–õ–µ–≤</div>
          <div class="z-card" data-sign="virgo"><span class="z-ico">‚ôç</span>–î–µ–≤–∞</div>
          <div class="z-card" data-sign="libra"><span class="z-ico">‚ôé</span>–í–µ—Å—ã</div>
          <div class="z-card" data-sign="scorpio"><span class="z-ico">‚ôè</span>–°–∫–æ—Ä–ø–∏–æ–Ω</div>
          <div class="z-card" data-sign="sagittarius"><span class="z-ico">‚ôê</span>–°—Ç—Ä–µ–ª–µ—Ü</div>
          <div class="z-card" data-sign="capricorn"><span class="z-ico">‚ôë</span>–ö–æ–∑–µ—Ä–æ–≥</div>
          <div class="z-card" data-sign="aquarius"><span class="z-ico">‚ôí</span>–í–æ–¥–æ–ª–µ–π</div>
          <div class="z-card" data-sign="pisces"><span class="z-ico">‚ôì</span>–†—ã–±—ã</div>
        </div>
        <div class="footnote">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–≤–æ–π –∑–Ω–∞–∫ ‚Äî –ø—Ä–∏—à–ª—ë–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø –≤ —á–∞—Ç.</div>
      </div>
    </section>

    <!-- Page: More -->
    <section class="page" id="page-more">
      <div class="grid cols-2">
        <div class="card pad">
          <h2>–ê–∫–∫–∞—É–Ω—Ç</h2>
          <div class="row" style="margin:8px 0">
            <button class="btn" id="btnBalance">–ü–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å</button>
            <button class="btn" id="btnPing">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—å</button>
          </div>
          <div class="tiny muted">–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—å¬ª.</div>
        </div>
        <div class="card pad">
          <h2>–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h2>
          <div class="muted">–ù–µ–π—Ä–æ‚Äë—Ç–∞—Ä–æ —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ —Ä–∞—Å–∫–ª–∞–¥–∞–º–∏, –±—ã—Å—Ç—Ä—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏ –∏ –º–∞–≥–∏—á–µ—Å–∫–æ–π —ç—Å—Ç–µ—Ç–∏–∫–æ–π.</div>
        </div>
      </div>
    </section>

    <!-- Shop -->
    <div class="sheet" id="shop">
      <div class="box">
        <div class="row" style="justify-content:space-between">
          <h3 style="margin:0">–ö—É–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è</h3>
          <button class="btn ghost" id="shopClose">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div class="packs" style="margin-top:10px">
          <div class="pack"><div><span class="pill">100 —Å–æ–æ–±—â–µ–Ω–∏–π</span></div><div class="muted">250 ‚ÇΩ</div><div><button class="btn primary buy" data-qty="100">–ö—É–ø–∏—Ç—å</button></div></div>
          <div class="pack"><div><span class="pill">300 —Å–æ–æ–±—â–µ–Ω–∏–π</span> <span class="pill" style="border-style:dashed">‚àí10%</span></div><div class="muted">725 ‚ÇΩ</div><div><button class="btn primary buy" data-qty="300">–ö—É–ø–∏—Ç—å</button></div></div>
          <div class="pack"><div><span class="pill">500 —Å–æ–æ–±—â–µ–Ω–∏–π</span> <span class="pill" style="border-style:dashed">‚àí15%</span></div><div class="muted">1180 ‚ÇΩ</div><div><button class="btn primary buy" data-qty="500">–ö—É–ø–∏—Ç—å</button></div></div>
          <div class="pack"><div><span class="pill">1000 —Å–æ–æ–±—â–µ–Ω–∏–π</span> <span class="pill" style="border-style:dashed">‚àí20%</span></div><div class="muted">2250 ‚ÇΩ</div><div><button class="btn primary buy" data-qty="1000">–ö—É–ø–∏—Ç—å</button></div></div>
        </div>
      </div>
    </div>

    <div class="footnote" id="dbg">DEV</div>
  </div>

  <!-- DEV STUB: –¥–µ–ª–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π –≤–Ω–µ Telegram -->
  <script>
    (function ensureTelegramStub(){
      if (!window.Telegram) window.Telegram = {};
      if (!window.Telegram.WebApp) {
        window.Telegram.WebApp = {
          sendData: (p)=> { console.log('[DEV] sendData:', p); alert('DEV SEND:\\n' + p); },
          close: ()=> console.log('[DEV] close'),
          openLink: (url)=> window.open(url, '_blank'),
          ready: ()=> console.log('[DEV] ready'),
          expand: ()=> console.log('[DEV] expand'),
          initDataUnsafe: { user: { id: 123456, username: 'dev_user' } },
          HapticFeedback: { impactOccurred: ()=>{} }
        };
        console.log('[DEV] Telegram WebApp stub enabled');
      }
    })();
  </script>

  <script>
    const tg = window.Telegram && window.Telegram.WebApp;
    const isDev = !!(tg && tg.initDataUnsafe && tg.initDataUnsafe.user && tg.initDataUnsafe.user.username === 'dev_user');

    function haptic(type='light'){ try{ Telegram.WebApp.HapticFeedback?.impactOccurred(type); }catch(_){} }
    function dbg(msg){ const el = document.getElementById('dbg'); if(el) el.textContent = String(msg); }

    // –û—Ç–ø—Ä–∞–≤–∫–∞: –≤ DEV –ø—Ä–æ—Å—Ç–æ alert, –≤ Telegram ‚Äî sendData –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ
    function send(action, extra={}){
      const payload = JSON.stringify({ action, ...extra });
      try { tg.sendData(payload); } catch (e) { console.error("sendData error:", e); dbg("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏"); }
      if (!isDev) { try { tg.close(); } catch(_) {} } // –ª–æ–∫–∞–ª—å–Ω–æ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
    }

    function initTelegram(){
      try{
        tg.ready(); tg.expand();
        const u = tg.initDataUnsafe?.user;
        if (u) document.getElementById('hello').textContent = `@${u.username || 'user'} ‚Ä¢ id ${u.id}`;
        dbg(isDev ? 'DEV —Ä–µ–∂–∏–º: –∫–ª–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç payload' : '–ì–æ—Ç–æ–≤–æ ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É ‚Äî –æ—Ç–≤–µ—Ç –ø—Ä–∏–¥—ë—Ç –≤ —á–∞—Ç');
      }catch(e){ console.warn("TG init error", e); }
    }

    const fmt = new Intl.DateTimeFormat('ru-RU',{hour:'2-digit',minute:'2-digit'});
    function tick(){ const el=document.getElementById('clock'); if(el) el.textContent = fmt.format(new Date()); }
    function initClock(){ tick(); setInterval(tick, 30_000); }

    function initSlider(){
      const host = document.getElementById('slider'); if(!host) return;
      const slides = Array.from(host.querySelectorAll('.slide'));
      const dots = Array.from(host.querySelectorAll('.dot'));
      let i = 0;
      setInterval(()=>{
        slides[i].classList.remove('active'); dots[i].classList.remove('active');
        i = (i+1) % slides.length;
        slides[i].classList.add('active'); dots[i].classList.add('active');
      }, 3800);
    }

    function initTabs(){
      document.querySelectorAll('.tab').forEach(t=>{
        t.addEventListener('click', ()=>{
          document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
          t.classList.add('active');
          const page = t.getAttribute('data-page');
          document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
          document.getElementById('page-'+page).classList.add('active');
          haptic();
        });
      });
    }

    function bindActions(){
      // Shop
      document.getElementById('btnTopup')?.addEventListener('click', ()=>{ document.getElementById('shop').classList.add('open'); haptic(); });
      document.getElementById('shopClose')?.addEventListener('click', ()=>{ document.getElementById('shop').classList.remove('open'); haptic(); });
      document.querySelectorAll('.buy').forEach(b=> b.addEventListener('click', ()=>{ const qty=parseInt(b.getAttribute('data-qty'),10)||100; haptic('medium'); send('buy', {qty}); }));

      // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
      document.querySelectorAll('.action').forEach(el=>{
        el.addEventListener('click', ()=>{
          const act = el.getAttribute('data-act'); haptic();
          if (act === 'ask'){
            const q = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å (—Å–¥–µ–ª–∞–µ–º —Ä–∞—Å–∫–ª–∞–¥ –∏–∑ 3 –∫–∞—Ä—Ç):'); if (!q) return;
            return send('custom_spread', { n: 3, topic: q });
          }
          if (act === 'yes_no'){
            const q = prompt('–í–∞—à –≤–æ–ø—Ä–æ—Å (–î–∞/–ù–µ—Ç):'); if (!q) return;
            return send('yes_no', { question: q });
          }
          return send(act);
        });
      });

      // –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
      const range = document.getElementById('cardsRange');
      const out = document.getElementById('cardsOut');
      range?.addEventListener('input', ()=> out.textContent = String(range.value));
      document.getElementById('btnDoCustom')?.addEventListener('click', ()=>{
        const n = parseInt(range.value, 10) || 3;
        const topic = (document.getElementById('topicInput').value || '').trim();
        haptic('medium'); send('custom_spread', { n, topic });
      });

      // –ü–æ–¥–ø–∏—Å–∫–∞
      document.getElementById('btnCodSave')?.addEventListener('click', ()=>{
        const on = !!document.getElementById('codToggle').checked;
        const time = (document.getElementById('codTime').value || '09:00').slice(0,5);
        send('cod_sub', { on, time });
      });

      // –ü—Ä–æ–º–æ–∫–æ–¥ / –†–µ—Ñ–µ—Ä–∞–ª / –ò—Å—Ç–æ—Ä–∏—è / –ü–æ–¥–¥–µ—Ä–∂–∫–∞
      document.getElementById('btnPromo')?.addEventListener('click', ()=>{
        const code = (document.getElementById('promoInput').value || '').trim(); if (!code) return;
        send('promo', { code });
      });
      document.getElementById('btnRef')?.addEventListener('click', ()=> send('ref_show'));
      document.getElementById('btnHistory')?.addEventListener('click', ()=> send('history'));
      document.getElementById('btnSupport')?.addEventListener('click', ()=>{
        try { tg.openLink('https://t.me/your_support'); } catch(_) { send('support'); }
      });

      // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ï—â—ë
      document.getElementById('btnBalance')?.addEventListener('click', ()=> send('balance'));
      document.getElementById('btnPing')?.addEventListener('click', ()=> send('ping', {ts: Date.now()}));

      // –ì–æ—Ä–æ—Å–∫–æ–ø
      document.querySelectorAll('.z-card').forEach(card=>{
        card.addEventListener('click', ()=>{
          const sign = card.getAttribute('data-sign');
          const period = document.getElementById('horPeriod').value;
          haptic(); send('horoscope', { sign, period });
        });
      });
    }

    function start(){
      initTelegram();
      initClock();
      initSlider();
      initTabs();
      bindActions();
    }

    document.addEventListener('DOMContentLoaded', start);
    if (document.readyState === 'complete' || document.readyState === 'interactive') setTimeout(start, 0);
  </script>
</body>
</html>
